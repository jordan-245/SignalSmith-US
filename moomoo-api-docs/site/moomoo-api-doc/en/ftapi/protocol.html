<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Protocol Introduction | moomoo API Doc v9.6</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="moomoo API Doc">
    <link rel="preload" href="/moomoo-api-doc/assets/css/0.styles.ea0b1d81.css" as="style"><link rel="preload" href="/moomoo-api-doc/assets/js/app.76d125c0.js" as="script"><link rel="preload" href="/moomoo-api-doc/assets/js/2.e1858e4a.js" as="script"><link rel="preload" href="/moomoo-api-doc/assets/js/12.c4851259.js" as="script"><link rel="preload" href="/moomoo-api-doc/assets/js/28.3fe3716c.js" as="script"><link rel="prefetch" href="/moomoo-api-doc/assets/js/10.94bcbf16.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/100.5aad709f.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/101.6315f7fb.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/102.6cece76d.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/103.40195fc5.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/104.e0830381.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/105.936eb4d9.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/106.ed3aee2b.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/107.7748df13.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/108.39b67a60.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/109.4b1236e2.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/11.2fbf442f.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/110.bc264581.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/111.a9652fa1.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/112.038c2fcd.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/113.587f4a42.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/114.9203188f.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/115.0d36e730.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/116.0f4b866f.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/117.76221359.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/118.caa7bc9a.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/119.ba336510.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/120.3683de14.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/121.ea95d7cb.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/122.618c3ed6.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/123.055b7010.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/124.c045cd63.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/125.d42b0714.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/126.b2f6e933.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/127.e9d110f8.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/128.a11f8202.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/129.6626eb94.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/13.4f3b3d7e.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/130.6539fcba.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/131.75bdf579.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/132.9d24d7e7.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/133.d9e1803b.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/134.a475efd5.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/135.cc33709b.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/136.21873923.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/137.69826660.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/138.31047450.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/139.ce995941.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/14.13b59c71.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/140.e70bdec0.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/141.d9d53a87.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/142.a04d0bea.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/143.a672978f.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/144.818a84ae.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/145.e46cc3df.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/146.a29ec4b9.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/147.5cfe641e.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/148.358ecaa0.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/149.3935be2f.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/15.3d02da17.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/150.40c46b61.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/151.3456807d.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/152.308a6ffd.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/153.d95721a5.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/154.c6b90cda.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/155.68c534de.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/156.fa6d7af3.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/157.a33831dd.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/158.56280019.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/159.9b880f55.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/16.33d80555.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/160.f4aa9622.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/161.727a3a78.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/162.941951ea.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/163.8b7da111.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/164.dfd53e0d.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/165.0c0855cd.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/166.21bd9238.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/167.e4ae9cf3.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/168.3f4281c0.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/169.f37d7335.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/17.6ac2d3ef.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/170.4376c120.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/171.948e10e3.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/18.7deab3c8.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/19.6e70cac3.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/20.c1df6286.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/21.5647999f.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/22.a50b564c.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/23.7870807e.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/24.9af08641.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/25.f509878d.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/26.b1244706.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/27.082f3f2b.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/29.f69366ed.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/3.f9c39755.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/30.aee38619.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/31.7ab0c7db.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/32.d4a3260b.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/33.74565b1d.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/34.29135595.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/35.424be492.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/36.3857d105.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/37.7d889315.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/38.637a73c2.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/39.aa973d8f.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/4.04d2c45d.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/40.480f6bad.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/41.62d11f5f.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/42.6861ed24.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/43.b8eb0308.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/44.e0fc8394.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/45.12015c46.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/46.acc698c7.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/47.997f18b2.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/48.c0a3ed4b.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/49.605a98fa.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/5.8c452a45.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/50.ab8e902f.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/51.93a43c80.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/52.d7c28131.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/53.bc4fcbfa.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/54.f2134ef8.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/55.0fb8c79f.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/56.d6f1d66e.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/57.e3b3ea62.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/58.a3b791f0.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/59.15613da4.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/6.9a2ded1c.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/60.60f97ce5.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/61.adf5183d.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/62.10e9e40e.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/63.f3768483.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/64.5e7093fb.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/65.437af457.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/66.fc1b6993.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/67.14953f01.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/68.5b8d5ad6.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/69.7f2d1c8b.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/7.f1cb5afb.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/70.2cfa12e6.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/71.0acce1e8.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/72.74bec554.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/73.00d57d06.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/74.bbe2f552.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/75.654e7361.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/76.e7abbb6c.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/77.9c2ecdf1.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/78.3eaa2d23.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/79.cc7f1ac2.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/8.e457aac2.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/80.148805ce.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/81.40dc2530.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/82.bbe1f83f.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/83.d1ecfd2c.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/84.5013f0ea.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/85.ed102602.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/86.f2975c25.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/87.7d6540bd.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/88.6f722f70.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/89.8fed8c82.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/9.c9d4402a.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/90.a15edebc.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/91.1f997c5d.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/92.dd51fa69.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/93.042545f6.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/94.71d9cc14.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/95.fb45f9d3.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/96.0f81a014.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/97.09768abd.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/98.cc14b450.js"><link rel="prefetch" href="/moomoo-api-doc/assets/js/99.6d2cbe79.js">
    <link rel="stylesheet" href="/moomoo-api-doc/assets/css/0.styles.ea0b1d81.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/moomoo-api-doc/en/" class="home-link router-link-active"><img src="/moomoo-api-doc/img/logo.png" alt="moomoo API Doc v9.6" class="logo"> <span class="site-name can-hide">moomoo API Doc v9.6</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="ftcode-links can-hide"><div class="ftcode-item"><div class="ftcode-dropdown-wrapper"><button type="button" aria-label="Programming Language" class="ftcode-dropdown-title"><span class="title">Programming Language</span> <span class="arrow right"></span></button> <ul class="ftcode-dropdown" style="display:none;"><li class="ftcode-dropdown-item"><!----> <span class="ftcode-link active"><span class="arrow active"></span> <span class="title active">Python</span></span></li><li class="ftcode-dropdown-item"><!----> <span class="ftcode-link"><span class="arrow"></span> <span class="title">C#</span></span></li><li class="ftcode-dropdown-item"><!----> <span class="ftcode-link"><span class="arrow"></span> <span class="title">Java</span></span></li><li class="ftcode-dropdown-item"><!----> <span class="ftcode-link"><span class="arrow"></span> <span class="title">C++</span></span></li><li class="ftcode-dropdown-item"><!----> <span class="ftcode-link"><span class="arrow"></span> <span class="title">JavaScript</span></span></li><li class="ftcode-dropdown-item"><!----> <span class="ftcode-link"><span class="arrow"></span> <span class="title">proto</span></span></li></ul></div></div></nav> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="简体中文" class="dropdown-title"><span class="title">简体中文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/moomoo-api-doc/ftapi/protocol.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/moomoo-api-doc/en/ftapi/protocol.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="ftcode-links"><div class="ftcode-item"><div class="ftcode-dropdown-wrapper"><button type="button" aria-label="Programming Language" class="ftcode-dropdown-title"><span class="title">Programming Language</span> <span class="arrow right"></span></button> <ul class="ftcode-dropdown" style="display:none;"><li class="ftcode-dropdown-item"><!----> <span class="ftcode-link active"><span class="arrow active"></span> <span class="title active">Python</span></span></li><li class="ftcode-dropdown-item"><!----> <span class="ftcode-link"><span class="arrow"></span> <span class="title">C#</span></span></li><li class="ftcode-dropdown-item"><!----> <span class="ftcode-link"><span class="arrow"></span> <span class="title">Java</span></span></li><li class="ftcode-dropdown-item"><!----> <span class="ftcode-link"><span class="arrow"></span> <span class="title">C++</span></span></li><li class="ftcode-dropdown-item"><!----> <span class="ftcode-link"><span class="arrow"></span> <span class="title">JavaScript</span></span></li><li class="ftcode-dropdown-item"><!----> <span class="ftcode-link"><span class="arrow"></span> <span class="title">proto</span></span></li></ul></div></div></nav> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="简体中文" class="dropdown-title"><span class="title">简体中文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/moomoo-api-doc/ftapi/protocol.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/moomoo-api-doc/en/ftapi/protocol.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Quick Start</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>OpenD</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Quote API</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Trade API</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading openData"><span>Basic API</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/moomoo-api-doc/en/ftapi/init.html" class="sidebar-link">Basic Functions</a></li><li><a href="/moomoo-api-doc/en/ftapi/common.html" class="sidebar-link">General Definitions</a></li><li><a href="/moomoo-api-doc/en/ftapi/protocol.html" aria-current="page" class="active sidebar-link">Protocol Introduction</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Q&amp;A</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="8508"><a href="#8508" class="header-anchor">#</a> Protocol Introduction</h1> <div class="ft-doc-switcher"><div class="tab-content" style="display:none;"><p>Futu API is an API SDK, encapsulated by Futu including mainstream programming languages (Python, Java, C #, C++, JavaScript) to make it easy for you to call and reduce the difficulty of trading strategy development.<br>
This part mainly introduces the underlying protocol of communication between script and OpenD service, which is suitable for users who do not use the above five programming languages.</p></div><div class="tab-content" style="display:;"><p>moomoo API is an API SDK, encapsulated by moomoo including mainstream programming languages (Python, Java, C #, C++, JavaScript) to make it easy for you to call and reduce the difficulty of trading strategy development.<br>
This part mainly introduces the underlying protocol of communication between script and OpenD service, which is suitable for users who do not use the above five programming languages.</p></div></div> <div class="custom-block tip"><p class="custom-block-title">Tips</p> <ul><li>If you are using a programming language that is one of the five mainstream programming languages mentioned above, you can skip this part.</li></ul></div> <h2 id="3541"><a href="#3541" class="header-anchor">#</a> Protocol Request Process</h2> <ul><li>Create a connection</li> <li>Initialize the connection</li> <li>Request data or receive pushed data</li> <li>Send KeepAlive protocol periodically to keep connected</li></ul> <div class="ft-doc-switcher"><div class="tab-content" style="display:none;"><p><img src="/moomoo-api-doc/assets/img/proto-process.8a7ac8f2.png" alt="proto-process"></p></div><div class="tab-content" style="display:;"><p><img src="/moomoo-api-doc/assets/img/proto_mmprocess.12101855.png" alt="proto-process"></p></div></div> <h2 id="7508"><a href="#7508" class="header-anchor">#</a> Protocol Design</h2> <p>The protocol data includes the protocol header and the protocol body. The protocol header is fixed, and the protocol body is determined according to the specific protocol.</p> <h3 id="218"><a href="#218" class="header-anchor">#</a> Protocol Header</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>struct APIProtoHeader
{
    u8_t szHeaderFlag[2];
    u32_t nProtoID;
    u8_t nProtoFmtType;
    u8_t nProtoVer;
    u32_t nSerialNo;
    u32_t nBodyLen;
    u8_t arrBodySHA1[20];
    u8_t arrReserved[8];
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><table><thead><tr><th style="text-align:left;">Field</th> <th style="text-align:left;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;">szHeaderFlag</td> <td style="text-align:left;">Packet header start flag, fixed as &quot;FT&quot;</td></tr> <tr><td style="text-align:left;">nProtoID</td> <td style="text-align:left;">Protocol ID</td></tr> <tr><td style="text-align:left;">nProtoFmtType</td> <td style="text-align:left;">Protocol type, 0 for Protobuf, 1 for Json</td></tr> <tr><td style="text-align:left;">nProtoVer</td> <td style="text-align:left;">Protocol version, used for iterative compatibility, currently 0</td></tr> <tr><td style="text-align:left;">nSerialNo</td> <td style="text-align:left;">Packet serial number, used to correspond to the request packet and return packet, and it is required to be incremented</td></tr> <tr><td style="text-align:left;">nBodyLen</td> <td style="text-align:left;">Body length</td></tr> <tr><td style="text-align:left;">arrBodySHA1</td> <td style="text-align:left;">SHA1 hash value of the original data of the packet body (after decryption)</td></tr> <tr><td style="text-align:left;">arrReserved</td> <td style="text-align:left;">Reserved 8-byte extension</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">Tips</p> <ul><li><font color="Gray"><strong><em>u8_t</em></strong></font> refer to 8-bit unsigned integer, <font color="Gray"><strong><em>u32_t</em></strong></font> refer to 32-bit unsigned integer</li> <li><font color="Gray"><strong><em>OpenD</em></strong></font> internal processing uses <font color="Gray"><strong><em>Protobuf</em></strong></font>, so the protocol format recommends using <font color="Gray"><strong><em>Protobuf</em></strong></font>, to reduce <font color="Gray"><strong><em>Json</em></strong></font> conversion overhead.</li> <li>The <font color="Gray"><strong><em>nProtoFmtType</em></strong></font> field specifies the data type of the package body, and the corresponding protocol type will be returned when the package is returned. The data type of the push protocol is specified by the <font color="Gray"><strong><em>OpenD</em></strong></font> configuration file</li> <li><font color="Gray"><strong><em>arrBodySHA1</em></strong></font> is used to verify the consistency of the requested data before and after network transmission, and must be filled in correctly</li> <li>The binary stream of the protocol header uses little-endian byte order, that is, generally there is no need to use <font color="Gray"><strong><em>ntohl</em></strong></font> and other related functions to convert the data</li></ul></div> <h3 id="8928"><a href="#8928" class="header-anchor">#</a> Protocol Body</h3> <h4 id="2656"><a href="#2656" class="header-anchor">#</a> Packet Body Structure of Protobuf Request</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>message C2S
{
    required int64 req = 1;
}

message Request
{
    required C2S c2s = 1;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="4592"><a href="#4592" class="header-anchor">#</a> Packet Body Structure of Protobuf Response</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>message S2C
{
    required int64 data = 1;
}

message Response
{
    required int32 retType = 1 [default = -400]; //RetType, result of return
    optional string retMsg = 2;
    optional int32 errCode = 3;
    optional S2C s2c = 4;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><table><thead><tr><th style="text-align:left;">Field</th> <th style="text-align:left;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;">c2s</td> <td style="text-align:left;">Request parameter structure</td></tr> <tr><td style="text-align:left;">req</td> <td style="text-align:left;">Request parameters, actually defined according to the protocol</td></tr> <tr><td style="text-align:left;">retType</td> <td style="text-align:left;">Request result</td></tr> <tr><td style="text-align:left;">retMsg</td> <td style="text-align:left;">The reason for the failed request</td></tr> <tr><td style="text-align:left;">errCode</td> <td style="text-align:left;">The corresponding error code for failed request</td></tr> <tr><td style="text-align:left;">s2c</td> <td style="text-align:left;">Response data structure, some protocols do not return data if there is no such field</td></tr> <tr><td style="text-align:left;">data</td> <td style="text-align:left;">Response data, actually defined according to the protocol</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">Tips</p> <ul><li>The package body format type request package is specified by <font color="Gray"><strong><em>nProtoFmtType</em></strong></font> field from protocol header, and the <font color="Gray"><strong><em>OpenD</em></strong></font> initiative push format is set in <a href="/moomoo-api-doc/en/ftapi/init.html#6650">InitConnect</a>.</li> <li>The original protocol file format is defined in <font color="Gray"><strong><em>Protobuf</em></strong></font> format. If you need <font color="Gray"><strong><em>json</em></strong></font> format transmission, it is recommended to use the <font color="Gray"><strong><em>protobuf3</em></strong></font> interface to directly convert to <font color="Gray"><strong><em>json</em></strong></font>.</li> <li>The enumeration value field definition uses signed integer, and the comment indicates the corresponding enumeration. The enumeration is generally defined in <font color="Gray"><strong><em>Common.proto, Qot_Common.proto, Trd_Common.proto</em></strong></font> files.</li> <li>The price, percentage and other data in the protocol are transmitted in floating point type. Direct use will cause accuracy problems. It needs to be rounded according to the accuracy (if not specified in the protocol, the default is 3 decimal places) before use.</li></ul></div> <h2 id="7390"><a href="#7390" class="header-anchor">#</a> Heartbeat Keep Alive</h2> <div class="ft-doc-switcher"><div class="tab-content" style="display:none;"><div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">syntax</span> <span class="token operator">=</span> <span class="token string">&quot;proto2&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">package</span> KeepAlive<span class="token punctuation">;</span>
<span class="token keyword">option</span> java_package <span class="token operator">=</span> <span class="token string">&quot;com.futu.openapi.pb&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">option</span> go_package <span class="token operator">=</span> <span class="token string">&quot;github.com/futuopen/ftapi4go/pb/keepalive&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;Common.proto&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">message</span> <span class="token class-name">C2S</span>
<span class="token punctuation">{</span>
	<span class="token keyword">required</span> <span class="token builtin">int64</span> time <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//Greenwich timestamp when the client sends the packet, in seconds</span>
<span class="token punctuation">}</span>

<span class="token keyword">message</span> <span class="token class-name">S2C</span>
<span class="token punctuation">{</span>
	<span class="token keyword">required</span> <span class="token builtin">int64</span> time <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//Greenwich timestamp when the server returned the packet, in seconds</span>
<span class="token punctuation">}</span>

<span class="token keyword">message</span> <span class="token class-name">Request</span>
<span class="token punctuation">{</span>
	<span class="token keyword">required</span> <span class="token positional-class-name class-name">C2S</span> c2s <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">message</span> <span class="token class-name">Response</span>
<span class="token punctuation">{</span>
	<span class="token keyword">required</span> <span class="token builtin">int32</span> retType <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">[</span><span class="token annotation">default</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">400</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//RetType, return result</span>
	<span class="token keyword">optional</span> <span class="token builtin">string</span> retMsg <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">optional</span> <span class="token builtin">int32</span> errCode <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	
	<span class="token keyword">optional</span> <span class="token positional-class-name class-name">S2C</span> s2c <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></div><div class="tab-content" style="display:;"><div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">syntax</span> <span class="token operator">=</span> <span class="token string">&quot;proto2&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">package</span> KeepAlive<span class="token punctuation">;</span>
<span class="token keyword">option</span> java_package <span class="token operator">=</span> <span class="token string">&quot;com.moomoo.openapi.pb&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">option</span> go_package <span class="token operator">=</span> <span class="token string">&quot;github.com/moomooopen/mmapi4go/pb/keepalive&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;Common.proto&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">message</span> <span class="token class-name">C2S</span>
<span class="token punctuation">{</span>
	<span class="token keyword">required</span> <span class="token builtin">int64</span> time <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//Greenwich timestamp when the client sends the packet, in seconds</span>
<span class="token punctuation">}</span>

<span class="token keyword">message</span> <span class="token class-name">S2C</span>
<span class="token punctuation">{</span>
	<span class="token keyword">required</span> <span class="token builtin">int64</span> time <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//Greenwich timestamp when the server returned the packet, in seconds</span>
<span class="token punctuation">}</span>

<span class="token keyword">message</span> <span class="token class-name">Request</span>
<span class="token punctuation">{</span>
	<span class="token keyword">required</span> <span class="token positional-class-name class-name">C2S</span> c2s <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">message</span> <span class="token class-name">Response</span>
<span class="token punctuation">{</span>
	<span class="token keyword">required</span> <span class="token builtin">int32</span> retType <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">[</span><span class="token annotation">default</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">400</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//RetType, return result</span>
	<span class="token keyword">optional</span> <span class="token builtin">string</span> retMsg <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">optional</span> <span class="token builtin">int32</span> errCode <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	
	<span class="token keyword">optional</span> <span class="token positional-class-name class-name">S2C</span> s2c <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></div></div> <ul><li><p><strong>Introduction</strong></p> <p>Heartbeat keep alive</p></li> <li><p><strong>Protocol ID</strong></p> <p>1004</p></li> <li><p><strong>Introduction</strong></p> <p>According to the heartbeat keeping alive interval returned by the <a href="/moomoo-api-doc/en/ftapi/init.html#7571">initialization protocol</a>, send the heartbeeat keep alive protocol to OpenD.</p></li></ul> <h2 id="4573"><a href="#4573" class="header-anchor">#</a> Encrypted Communication Process</h2> <ul><li>If OpenD is configured with encryption, <a href="/moomoo-api-doc/en/quote/base.html">InitConnect</a> must use <a href="/moomoo-api-doc/en/qa/other.html#1479">RSA</a> public key encryption to initialize the connection protocol, and other subsequent protocols use the random key returned by InitConnect for AES encrypted communication.</li> <li>The encryption process of OpenD draws on the SSL protocol. Considering that services and applications are generally deployed locally, we simplifies the related processes. OpenD shares the same <a href="/moomoo-api-doc/en/qa/other.html#1479">RSA</a> private key file with the access Client. Please save and distribute the private key file properly.</li> <li>Go to this <a href="http://web.chacuo.net/netrsakeypair" target="_blank" rel="noopener noreferrer">URL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to generate a random <a href="/moomoo-api-doc/en/qa/other.html#1479">RSA</a> key pair online. The key format must be PCKS#1, the key length can be 512, 1024, and do not set password. Copy and save the generated private key to a file, and then configure the path of the private key file to the <strong>rsa_private_key</strong> configuration item agreed upon in <a href="/moomoo-api-doc/en/opend/opend-cmd.html#149">OpenD Configuration</a>.</li> <li><strong>It is recommended that users who have real trade configure encryption to avoid leakage of account and trade information.</strong></li></ul> <div class="ft-doc-switcher"><div class="tab-content" style="display:none;"><p><img src="/moomoo-api-doc/assets/img/encrypt.9d680476.png" alt="encrypt"></p></div><div class="tab-content" style="display:;"><p><img src="/moomoo-api-doc/assets/img/mmencrypt.71115b21.png" alt="encrypt"></p></div></div> <h2 id="9579"><a href="#9579" class="header-anchor">#</a> RSA Encryption and Decryption</h2> <ul><li><a href="/moomoo-api-doc/en/opend/opend-cmd.html#149">OpenD configuration</a> Convention <strong>rsa_private_key</strong> is the path of the private key file</li> <li>OpenD shares the same private key file with the access client</li> <li>RSA encryption and decryption is only used for InitConnect requests, and is used to securely obtain symmetric encryption key of other request protocols</li> <li>The <a href="/moomoo-api-doc/en/qa/other.html#1479">RSA</a> key of OpenD is 1024-bit, the filling method is PKCS1, public key encryption, private key decryption, public key can be generated by private key</li></ul> <h3 id="8526"><a href="#8526" class="header-anchor">#</a> Send Data Encryption</h3> <ul><li>RSA encryption rules: If the number of key bits is key_size, the maximum length of a single encryption string is (key_size)/8-11. The current number of bits is 1024, and the length of one encryption can be set to 100.</li> <li>Divide the plaintext data into one or several segments of up to 100 bytes for encryption, and the final encrypted data is spliced by all segmented encrypted data.</li></ul> <h3 id="3436"><a href="#3436" class="header-anchor">#</a> Receive Data Decryption</h3> <ul><li>RSA decryption also follows the segmentation rule. For a 1024-bit key, the length of each segment to be decrypted is 128-byte.</li> <li>Divide the ciphertext data into one or several segments of up to 128 bytes for decryption, and the final decrypted data is spliced by all segmented decrypted data.</li></ul> <h2 id="7863"><a href="#7863" class="header-anchor">#</a> AES Encryption and Decryption</h2> <ul><li>The encryption key is returned by the InitConnect protocol</li> <li>The ecb encryption mode of AES is used by default.</li></ul> <h3 id="8526-2"><a href="#8526-2" class="header-anchor">#</a> Send Data Encryption</h3> <ul><li>AES encryption requires that the length of the source data must be an integer multiple of 16, so it needs to be aligned with ‘0’ before encryption. Record mod_len for source data length and 16 module.</li> <li>Because it is possible to modify the source data before encryption, it is necessary to add a 16-byte padding data block at the end of the encrypted data. The last byte is assigned mod_len, and the remaining bytes are assigned the value '0'. The encrypted data and additional populated data blocks are spliced as the body data to be sent in the end.</li></ul> <h3 id="3436-2"><a href="#3436-2" class="header-anchor">#</a> Receive Data Decryption</h3> <ul><li>For protocol body data, first take out the last byte and record it as mod_len, then truncate the body to the 16-byte padding data block before decrypting it (corresponding to the encrypted padding extra data block logic).</li> <li>When mod_len is 0, the above decrypted data is the body data returned by the protocol, otherwise the tail (16-mod_len) length of the data used for filling and alignment needs to be truncated.</li></ul> <p><img src="/moomoo-api-doc/assets/img/aes.729f06b1.png" alt="aes"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/moomoo-api-doc/en/ftapi/common.html" class="prev">
        General Definitions
      </a></span> <span class="next"><a href="/moomoo-api-doc/en/qa/opend.html">
        OpenD Related
      </a>
      →
    </span></p></div> </main> <aside class="rightbar"><ul class="rightbar-links"><a href="/moomoo-api-doc/en/ftapi/protocol.html" aria-current="page" class="active rightbar-link">Protocol Introduction</a><ul class="rightbar-sub-headers"><li class="rightbar-sub-header"><a href="/moomoo-api-doc/en/ftapi/protocol.html#3541" class="rightbar-link">Protocol Request Process</a></li><li class="rightbar-sub-header"><a href="/moomoo-api-doc/en/ftapi/protocol.html#7508" class="rightbar-link">Protocol Design</a></li><li class="rightbar-sub-header"><a href="/moomoo-api-doc/en/ftapi/protocol.html#7390" class="rightbar-link">Heartbeat Keep Alive</a></li><li class="rightbar-sub-header"><a href="/moomoo-api-doc/en/ftapi/protocol.html#4573" class="rightbar-link">Encrypted Communication Process</a></li><li class="rightbar-sub-header"><a href="/moomoo-api-doc/en/ftapi/protocol.html#9579" class="rightbar-link">RSA Encryption and Decryption</a></li><li class="rightbar-sub-header"><a href="/moomoo-api-doc/en/ftapi/protocol.html#7863" class="rightbar-link">AES Encryption and Decryption</a></li></ul></ul></aside></div><div class="global-ui"></div></div>
    <script src="/moomoo-api-doc/assets/js/app.76d125c0.js" defer></script><script src="/moomoo-api-doc/assets/js/2.e1858e4a.js" defer></script><script src="/moomoo-api-doc/assets/js/12.c4851259.js" defer></script><script src="/moomoo-api-doc/assets/js/28.3fe3716c.js" defer></script>
  </body>
</html>
