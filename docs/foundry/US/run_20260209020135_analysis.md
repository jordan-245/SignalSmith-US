# Foundry Run Analysis ‚Äî 20260209020135

**Date:** 2026-02-06  
**Run ID:** 20260209020135  
**Market:** US  
**Status:** ‚ö†Ô∏è Quality gate warning (AUC below threshold)

---

## Executive Summary

First production-ready run with the unified model stack (LR+StandardScaler + LightGBM+early stopping ‚Üí ensemble ‚Üí calibration). Pipeline completed successfully but model performance is marginal.

**Key Metrics:**
- **Coverage:** 495/498 tickers predicted (99.4%)
- **Training rows:** 540,219
- **Validation AUC:** 0.5079 (below min 0.52)
- **Calibration error:** 0.0 (excellent)
- **Brier score (5d):** 0.2502 (acceptable)

**Pipeline Timing:**
- Prices: 38.7s
- Features: 3.8s
- Labels: 1.2s
- Models: 7.0s
- Quality gates: 1.0s
- Report: 3.1s
- **Total:** ~54.8s

---

## Quality Gate Analysis

### ‚ö†Ô∏è Warning: `val_auc 0.5079 < min 0.52`

The ensemble's validation AUC fell just below the threshold:
- **Observed:** 0.5079
- **Minimum:** 0.52
- **Gap:** -0.0121

**Context:**
- Random guessing = 0.50
- Current model = 0.5079 (barely above random)
- This is the **first run with the unified stack** after fixing 3 divergent model implementations

**Calibration quality is perfect (ECE = 0.0)**, meaning the probabilities are well-calibrated even though the model has weak discriminative power.

---

## Model Performance Breakdown

### Per-Horizon Results (Calibration Window: 2025-07-21 to 2026-01-08)

| Horizon | AUC | Brier | Hit Rate | ECE | Assessment |
|---------|-----|-------|----------|-----|------------|
| 1d | 0.4996 | 0.2502 | 51.2% | 0.0159 | ‚ùå Below random |
| 5d | 0.4984 | 0.2504 | 53.6% | 0.0328 | ‚ùå Below random |
| 20d | 0.5000 | 0.2472 | 59.1% | 0.0739 | üü° Random baseline |

**Observations:**
1. **1d and 5d horizons** perform worse than random (AUC < 0.50) ‚Äî potential signal inversion or feature issues
2. **20d horizon** is exactly at random baseline (AUC = 0.50)
3. **Hit rates** are above 50% for all horizons, which is encouraging
4. **ECE increases with horizon** (calibration degrades at longer timeframes)

---

## Top Predictions

**Top 5 tickers by ensemble P(up):**

1. **DDOG** ‚Äî 56.2% (P_1d: 53.1%, P_5d: 54.5%, P_20d: 61.1%)
2. **NOW** ‚Äî 56.1% (P_1d: 52.2%, P_5d: 54.5%, P_20d: 61.7%)
3. **LW** ‚Äî 55.2% (P_1d: 51.8%, P_5d: 52.7%, P_20d: 61.1%)
4. **PSKY** ‚Äî 53.9% (P_1d: 52.2%, P_5d: 52.7%, P_20d: 56.9%)
5. **CSGP** ‚Äî 53.9% (P_1d: 52.2%, P_5d: 54.5%, P_20d: 54.9%)

**Pattern:** All probabilities cluster tightly around 50-56%, consistent with weak discriminative power. The model is not confident about any strong directional moves.

---

## Feature Analysis

**9 features used:**
- `ret_1d`, `ret_5d`, `ret_20d` ‚Äî momentum
- `vol_20d` ‚Äî volatility
- `ma_ratio_20_50`, `ma_ratio_50_200` ‚Äî trend
- `px_gt_sma200`, `sma50_gt_sma200` ‚Äî binary regime
- `rel_strength_20d` ‚Äî relative momentum vs SPY

**Known issues from review:**
1. No volume-based features (volume data ingested but unused)
2. No cross-sectional rank features (all features are time-series only)
3. No sector/industry information (can't detect rotations)
4. 100% trend/momentum ‚Äî no mean reversion signals

---

## Model Stack Details

**Unified Stack (post-fix):**
1. **BaselineLogistic:** LR with `StandardScaler` + L2 regularization (C=1.0)
2. **TreeModel:** LightGBM (`max_depth=5`, `n_estimators=300`, `learning_rate=0.05`, `min_child_samples=50`, `reg_lambda=1.0`, `colsample_bytree=0.7`) with early stopping
3. **EnsembleModel:** 40% LR + 60% LGBM
4. **CalibrationWrapper:** Isotonic regression on held-out set (126 days)

**Training set:** ~540K rows (500 tickers √ó ~1,080 days after NaN drops)  
**Calibration set:** ~126 trading days (~6 months)

---

## Actionable Recommendations

### üî¥ High Priority

1. **Investigate 1d/5d AUC < 0.50** ‚Äî models performing worse than random suggests:
   - Potential label leakage (are labels correctly forward-shifted?)
   - Feature sign inversion (e.g., high vol predicting down instead of up)
   - Target variable imbalance (check class distribution)

2. **Add volume features** ‚Äî Volume confirms price moves and is completely unused:
   ```python
   "vol_ratio_20d": volume / volume.rolling(20).mean()
   "dollar_volume_20d": (close * volume).rolling(20).mean()
   ```

3. **Add cross-sectional features** ‚Äî Rank tickers by momentum/vol within each date to reduce outlier sensitivity

### üü° Medium Priority

4. **Feature importance analysis** ‚Äî LightGBM can output feature importances; track which features drive predictions

5. **Add mean reversion features** ‚Äî Current stack is 100% momentum/trend; add RSI, z-score

6. **Hyperparameter tuning** ‚Äî All params are defaults; try grid search on:
   - LR `C` (regularization strength)
   - LGBM `learning_rate`, `max_depth`, `n_estimators`

7. **Increase calibration window** ‚Äî 126 days may be too short; try 252 (1 year)

### ‚ö™ Low Priority

8. **Add sector features** ‚Äî GICS sector dummies for rotation detection

9. **Regime-aware training** ‚Äî Train separate models for high/medium/low vol regimes (the `RegimeClassifier` exists but is unused)

---

## Next Steps

1. **Root cause 1d/5d AUC < 0.50** ‚Äî validate label construction in `build_labels()`
2. **Run backtest** ‚Äî use `foundry_run.py --backtest` to get walk-forward performance over multiple folds
3. **Add volume features** ‚Äî quick win, data already available
4. **Monitor next scheduled run** ‚Äî pre-market Monday 08:15 ET will be first automated production run

---

## Run Log (Detailed)

```json
[
  {
    "run_id": "20260209020135",
    "stage": "foundry_prices",
    "status": "ok",
    "date": "2026-02-06",
    "timestamp": "2026-02-09T02:02:14.925839+00:00",
    "stats": {"elapsed_s": 38.66}
  },
  {
    "run_id": "20260209020135",
    "stage": "foundry_features",
    "status": "ok",
    "date": "2026-02-06",
    "timestamp": "2026-02-09T02:02:19.616869+00:00",
    "stats": {"elapsed_s": 3.75}
  },
  {
    "run_id": "20260209020135",
    "stage": "foundry_labels",
    "status": "ok",
    "date": "2026-02-06",
    "timestamp": "2026-02-09T02:02:21.770042+00:00",
    "stats": {"elapsed_s": 1.21}
  },
  {
    "run_id": "20260209020135",
    "stage": "foundry_models",
    "status": "ok",
    "date": "2026-02-06",
    "timestamp": "2026-02-09T02:02:29.663380+00:00",
    "stats": {"elapsed_s": 6.95}
  },
  {
    "run_id": "20260209020135",
    "stage": "foundry_quality_gates",
    "status": "warn",
    "date": "2026-02-06",
    "timestamp": "2026-02-09T02:02:30.579119+00:00",
    "stats": {},
    "warnings": ["val_auc 0.5079 < min 0.52"]
  },
  {
    "run_id": "20260209020135",
    "stage": "foundry_quality_gates",
    "status": "ok",
    "date": "2026-02-06",
    "timestamp": "2026-02-09T02:02:31.523257+00:00",
    "stats": {"elapsed_s": 0.95}
  },
  {
    "run_id": "20260209020135",
    "stage": "foundry_report",
    "status": "ok",
    "date": "2026-02-06",
    "timestamp": "2026-02-09T02:02:35.471067+00:00",
    "stats": {"elapsed_s": 3.05}
  }
]
```

---

*Analysis saved: 2026-02-09 02:08 UTC*
